<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
    <link href="style.css" type="text/css" rel="stylesheet">
    <title>Yong&Yi-Invoice Generator</title>
    <script>
        if ( window.history.replaceState ) {
          window.history.replaceState( null, null, window.location.href );
        }
    </script>
</head>
<body class="main-contents" style="background-color: black;">
    <%
const timestamp = sellInvoiceResults[0].timestamp;
const newTimestamp = new Date(timestamp);
newTimestamp.setDate(newTimestamp.getDate() + 30);
const day = newTimestamp.getDate().toString().padStart(2, '0');
const month = (newTimestamp.getMonth() + 1).toString().padStart(2, '0');
const year = newTimestamp.getFullYear().toString().slice(-2);
const formattedNewTimestamp = `${day}/${month}/${year}`;
%>
    <%- include('partials/nav');%>
    <main class="main-content" style="display: flex;">
      <div id="printable-content" style="width:22.5cm ;height: 35.7cm;background-color: white;padding: 1.016cm;">
        <p id="header" style="font-family: Arial;font-weight: bold;margin: 0%;margin-bottom: 5px;font-size: 2em;text-align: center;background-color:rgb(220, 220, 220)">YONG &amp; YI PARTNERS ENTERPRISE</p>
              <p style="margin:0%;font-family: Arial;text-align: center;font-size: 15px;"><a style="font-weight: bold;">202203263613 (CA0355099-M)</a>
                <br>11A,LORONG TEKUKUR INDAH 4,
                <br>TAMAN TEKUKUR INDAH
                <br>14300 NIBONG TEBAL, PULAU PINANG, MALAYSIA
                <br>TEL:+60 17-4593823
                <br>EMAIL: SYENYIK10@GMAIL.COM</p>
              <p id="invoice"style="font-family: Arial;font-weight: bold;margin-top:5px;margin-bottom:20px;color:darkblue;font-size: 3em; text-align: center;background-color: rgb(224, 250, 255);">INVOICE</p>
        <% if (sellInvoiceResults && sellInvoiceResults.length) { %>
        <div style="display: inline-block;font-weight: bold;font-family: Arial, Helvetica, sans-serif;">Invoice for<br><br>
        <% if (sellInvoiceResults[0].Address1 === '') { %>
          <%= sellInvoiceResults[0].Name %><br>
          <%= sellInvoiceResults[0].PostCode %>
          <%= sellInvoiceResults[0].State %><br>
          <%= sellInvoiceResults[0].City %><br>
          <%= sellInvoiceResults[0].Country %>
        <% } else if (sellInvoiceResults[0].Address2 === '') { %>
            <%= sellInvoiceResults[0].Name %><br>
          <%= sellInvoiceResults[0].Address1 %>,<br>
          <%= sellInvoiceResults[0].PostCode %>
          <%= sellInvoiceResults[0].State %><br>
          <%= sellInvoiceResults[0].City %><br>
          <%= sellInvoiceResults[0].Country %>
        <% } else if (sellInvoiceResults[0].Address3 === '') { %>
          <%= sellInvoiceResults[0].Name %><br>
          <%= sellInvoiceResults[0].Address1 %>,<br>
          <%= sellInvoiceResults[0].Address2 %>,<br>
          <%= sellInvoiceResults[0].PostCode %>
          <%= sellInvoiceResults[0].State %><br>
          <%= sellInvoiceResults[0].City %><br>
          <%= sellInvoiceResults[0].Country %>
        <% } else { %>
          <%= sellInvoiceResults[0].Name %><br>
          <%= sellInvoiceResults[0].Address1 %>,<br>
          <%= sellInvoiceResults[0].Address2 %>,<br>
          <%= sellInvoiceResults[0].Address3 %>
          <%= sellInvoiceResults[0].PostCode %>
          <%= sellInvoiceResults[0].State %><br>
          <%= sellInvoiceResults[0].City %><br>
          <%= sellInvoiceResults[0].Country %>
        <% } %>
        </div>
        <div style="float: right;">
          <table id="myTable" style="display: inline-block; margin-bottom: 15px;font-family: Arial, Helvetica, sans-serif;">
            <thead style="text-align: center;">
              <tr>
                <th style="width: 140px;border: 1px solid black;padding: 2px;">Invoice #</th>
                <th colspan="2" style="width: 180px;border: 1px solid black;padding: 2px;">Invoice Date</th>
              </tr>
            </thead>
            <tbody style="text-align: center;">
              <tr>
                <td style="border: 1px solid black;padding: 2px;"><%= invoiceNumber %></td>
                <td style="border: 1px solid black;padding: 2px;"><%= sellInvoiceResults[0].timestamp ? (() => {
                    const timestamp = sellInvoiceResults[0].timestamp;
                    const date = new Date(timestamp);
                    const day = date.getDate().toString().padStart(2, '0');
                    const month = (date.getMonth() + 1).toString().padStart(2, '0');
                    const year = date.getFullYear().toString().slice(-2);
                    const formattedDate = `${day}/${month}/${year}`;
                    return formattedDate;
                })() : '' %></td>
              </tr>
            </tbody>
          </table><br>
          <div style="float: right;font-family: Arial, Helvetica, sans-serif;">
            <table id="myTable" style="display: inline-block; margin-bottom: 15px;">
              <thead style="text-align: center;">
                <tr>
                  <th colspan="2" style="width: 180px;border: 1px solid black;padding: 2px;">Due Date</th>
                </tr>
              </thead>
              <tbody style="border: 1px solid black;padding: 2px;text-align: center;">
                <tr>
                  <td style="border: 1px solid black;padding: 2px;"><%= formattedNewTimestamp %></td>
                </tr>
              </tbody>
            </table><br>
          </div>
          <div style="font-family: Arial, Helvetica, sans-serif;">
            <br><br><br><div style="font-weight: bold;"> Payable to</div>
            <table id="myTable" style="display: inline-block; margin-bottom: 15px;">
                <thead>
                    <tr>
                      <th id="h1" style="width: 140px;border: 1px solid black;padding: 2px;color: rgb(48, 48, 48);font-weight: 400;font-weight: bold;">Bank Name:</th>
                      <td colspan="2" style="width: 180px;border: 1px solid black;padding: 2px;">
                        Hong Leong Bank
                      </td>
                    </tr>
                      <tr>
                        <th id="h1" style="width: 140px;border: 1px solid black;padding: 2px;color: rgb(48, 48, 48);font-weight: 400;font-weight: bold;">Account Name:</th>
                        <td colspan="2" style="width: 180px;border: 1px solid black;padding: 2px;">Yong & Yi<br>Patners Enterprise</td>
                      </tr>
                      <tr>
                        <th id="h1" style="width: 140px;border: 1px solid black;padding: 2px;color: rgb(48, 48, 48);font-weight: 400;font-weight: bold;">Account No:</th>
                        <td colspan="2" style="width: 180px;border: 1px solid black;padding: 2px;">13300319010</td>
                      </tr>
                  </thead>
                  
            </table>
          </div>
        </div>
        <div style="float: right ;width: 100%; border-bottom: 1px solid rgb(0, 0, 0);"></div>
        <div style="padding-top: 100px;">
          <div style="font-family: Arial, Helvetica, sans-serif;">
            <table>
              <thead>
                <tr>
                  <th id="h1" style="width: 60px;color:darkblue">No #</th>
                  <th style="width: 480px;text-align: center;color:darkblue">Description</th>
                  <th style="width: 80px;text-align: center;color:darkblue">Qty</th>
                  <th style="width: 90px;text-align: center;color:darkblue">Unit Price</th>
                  <th style="width: 90px;text-align: center;color:darkblue">Total Price</th>
                </tr>
              </thead>
              <tbody>
                <% let total = 0 %>
                <% let counter = 1; %>
                <% for (let i = 0; i < itemsSellResults.length; i++) { %>
                <tr>
                <td style="font-weight: bold;"><%= counter %>.</td>
                <td style="font-weight: bold;">
                  <%= itemsSellResults[i].Content_SKU %>
                  <span style="text-align: right;font-size: small;margin-left: 5px;"><%= itemsSellResults[i].product_name %></span>
                </td>
                <td style="text-align: center;"><%= itemsSellResults[i].TotalQuantity %></td>
                <td style="text-align: center;"><%= itemsSellResults[i].UnitPrice %></td>
                <% total = itemsSellResults[i].UnitPrice * itemsSellResults[i].TotalQuantity %>
                <td style="text-align: center;"><%= total %></td>
                </tr>
                <% counter++ %>
                <% } %>
              </tbody>
            </table>
          </div><br><br><br><br>
          <div style="width: 100%; border-bottom: 1px solid rgb(0, 0, 0);"></div>
          <br>
          <div style="font-family: Arial, Helvetica, sans-serif;">
            <div style="display: inline-block">
              <a>Notes:</a>
            </div>
            <div style="float: right;">
              <table>
                <thead>
                  <tr>
                    <th style="width: 130px;text-align: right;">Subtotal</th>
                    <td style="width: 200px;text-align: right;font-weight: bold;padding-right: 10px;">RM <%= totalAmount.toFixed(2) %></td>
                  </tr>
                  <tr>
                    <th style="width: 130px;text-align: right;">Discount</th>
                    <td style="text-align: right;font-weight: bold;padding-right: 10px;">-</td>
                  </tr>
                  <tr>
                    <th style="width: 130px;text-align: right;">Total</th>
                    <td style="text-align: right;font-weight: bold;padding-right: 10px;">RM <%= totalAmount.toFixed(2) %></td>
                  </tr>
                  <tr>
                    <th style="width: 130px;text-align: right;">Paid Amount</th>
                    <td style="text-align: right;font-weight: bold;padding-right: 10px;">RM <%= totalpaid.toFixed(2) %></td>
                  </tr>
                  <% if (balance < 0) { %>
                  <tr>
                    <th style="width: 130px;text-align: right;">Over Paid</th>
                    <td style="text-align: right;font-weight: bold;padding-right: 10px;">RM <%= Math.abs(balance).toFixed(2) %></td>
                  </tr>
                  <% } else { %>
                    <tr>
                      <th style="width: 130px;text-align: right;">Balance Left</th>
                      <td style="text-align: right;font-weight: bold;padding-right: 10px;">RM <%= balance.toFixed(2) %></td>
                    </tr>
                </thead>
                <% }} %>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div>
        <button class="btn btn-success" onclick="printTable()" style="width: 500px;height: 500px;">Print</button>
        <div style="text-align: center;">
            <a href="/yyinvoice_generate" class="btn btn-danger" style="width: 500px;text-align: center;height: 500px;margin: auto;padding-top: 50%;">Back</a>
        </div>
      </div>
    </main>
    <script>
      function printTable() {
        var content = document.getElementById("printable-content").innerHTML;
        var win = window.open('', '', 'height=1000,width=1000');
        win.document.write('<html><head>');
        win.document.write('<style>table{border-collapse: collapse} #header{text-align: center; background-color:rgb(220, 220, 220);} #h1{text-align:left;}</style>');
        win.document.write('</head><body>');
        win.document.write(content);
        win.document.write('</body></html>');
        win.print();
        win.close();
      }
    </script>
</body>
</html>
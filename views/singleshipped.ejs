<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.4/dist/umd/popper.min.js" integrity="sha384-DGGpTdmN8XhT8eKlgnQUxv3VwQgktmx30ybdm9HeR6eR5oytY/H3fGkRDX7hRch+" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
    <link href="style.css" type="text/css" rel="stylesheet">
    <title>Shipped Record</title>
    <script>
      if (window.history.replaceState) {
        window.history.replaceState(null, null, window.location.href);
      }
    </script>
  </head>
  <body class="main-contents">
    <%- include('partials/nav'); %>
    <main class="main-content">
      <h1>Shipped Record - Single Ship</h1>
      <ul>
        <li>
          <a href="/singleshipped">
            <span>Single Shipped</span>
          </a>
        </li>
      </ul>
      <ul>
        <li>
          <a href="/bulkshipped">
            <span>Bulk Shipped</span>
          </a>
        </li>
      </ul>
      <div style="display: flex;">
        <form id="singles-form" method="POST" action="/singleshipped" enctype="multipart/form-data">
          <label class="form_name3" for="trackingno">Tracking Number</label>
          <input class="form_id" type="text" name="trackingno" required><br>
          <label class="form_name3" for="date">Date</label>
          <input class="form_id" type="date" name="date" required><br>
          <label class="form_name3" for="invoice">Invoice Number</label>
          <input class="form_id" type="text" name="invoice" id="invoiceInput" required><br>
          <label class="form_name3" for="sku">SKU</label>
          <input class="form_id" type="text" name="sku" id="skuInput" required><br>
          <label class="form_name3" for="productname">Product Name</label>
          <input class="form_id" type="text" name="productname" id="productNameInput" required><br>
          <label class="form_name3" for="size">Size US</label>
          <select class="form_id" name="size" id="sizeDropdown">
            <!-- Options will be dynamically added here -->
          </select><br>
          <label class="form_name3" for="remarks">Remarks</label><br>
          <textarea style="width: 324.5px;" type="text" name="remarks"></textarea><br><br>
          <div class="button">
            <button class="form_button" type="submit">Submit</button>
            <button class="form_button" type="reset">Clear</button>
          </div>
        </form><br>
        <div style="margin-left: 100px;">
          <h1>Pending to Ship</h1>
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Invoice NO.</th>
                <th>SKU</th>
                <th>Product Name</th>
                <th>Size US</th>
                <th>Quantity</th>
              </tr>
            </thead>
            <tbody>
              <% data.forEach(item => { %>
                <tr>
                  <td><%= item.InvoiceNumber %></td>
                  <td><%= item.Content_SKU %></td>
                  <td><%= item.product_name %></td>
                  <td><%= item.SizeUS %></td>
                  <td><%= item.totalQuantity %></td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
      </div>
      <script>
        $(document).ready(function() {
          $('#invoiceInput').on('change', function() {
            const invoice = $(this).val();
            const sku = $('#skuInput').val();
            fetchProductData(invoice, sku);
          });

          $('#skuInput').on('change', function() {
            const invoice = $('#invoiceInput').val();
            const sku = $(this).val();
            fetchProductData(invoice, sku);
          });

          function fetchProductData(invoice, sku) {
            $.ajax({
              url: '/singleshippeds',
              method: 'GET',
              data: { invoice, sku },
              success: function(response) {
                $('#productNameInput').val(response.productName);
                updateSizeDropdown(response.sizes);
              },
              error: function() {
                console.error('Error retrieving product data');
              }
            });
          }

          function updateSizeDropdown(sizes) {
            const sizeDropdown = $('#sizeDropdown');
            sizeDropdown.empty(); // Clear previous options

            sizes.forEach(function(size) {
              const option = $('<option>').val(size).text(size);
              sizeDropdown.append(option);
            });
          }
        });
      </script>
    </main>
  </body>
</html>
